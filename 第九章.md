# 第九章
## 阿里云服务器
## 1. 创建工作用户acs并赋予sudo权限
## 2. 登录到新服务器。打开AC Terminal，然后：
```ssh root@xxx.xxx.xxx.xxx```  # xxx.xxx.xxx.xxx替换成新服务器的公网IP
## 3. 创建acs用户：
```adduser acs```  # 创建用户acs
```usermod -aG sudo acs```  # 给用户acs分配sudo权限
## 4. 配置免密登录方式
   退回AC Terminal，然后配置acs用户的别名和免密登录
```vim .ssh/config```
``` 
   Host springboot（名字）
   HostName XXXXX(Ip地址)
   User acs   
```

## 5. 设置免密登录
```
ssh-copy-id springboot
ssh springboot #登录
```

## 6. 配置新服务器的工作环境
将AC Terminal的配置传到新服务器上：
```
scp .bashrc .vimrc .tmux.conf server_name:  # server_name需要换成自己配置的别名
```

## 7.  安装tmux和docker
登录自己的服务器，然后安装tmux：
```
sudo apt-get update
sudo apt-get install tmux
```
打开tmux。（养成好习惯，所有工作都在tmux里进行，防止意外关闭终端后，工作进度丢失）
然后在tmux中根据docker安装教程安装docker即可。(https://docs.docker.com/engine/install/ubuntu/)

##  8. 将当前用户添加到docker用户组
为了避免每次使用docker命令都需要加上sudo权限，可以将当前用户加入安装中自动创建的docker用户组(可以参考官方文档)：
```
sudo usermod -aG docker $USER
```
执行完此操作后，需要退出服务器，再重新登录回来，才可以省去sudo权限。

## 9. 打开docker
```
docker start kob_server #如果不小心关闭，可以用这个打开
```
## 10. 配置docker
进入AC Terminal，然后：
```
scp /var/lib/acwing/docker/images/docker_lesson_1_0.tar server_name:  # 将镜像上传到自己租的云端服务器
ssh server_name  # 登录自己的云端服务器

docker load -i docker_lesson_1_0.tar  # 将镜像加载到本地
docker run -p 20000:22 -p 443:443 -p 80:80 -p 3000 -p 3001 -p 3002 -itd --name kob_server django_lesson:1.0  # 创建并运行django_lesson:1.0镜像
docker attach my_docker_server  # 进入创建的docker容器
```
去云平台控制台中修改安全组配置，放行端口20000和其他端口
## 11. 更新库
```
sudo apt-get update
```
## 12. 创建云端数据库
安装：
```
sudo apt-get install mysql-server
```
启动：
```
sudo service mysql start
```
设置root用户的密码：
```
ALTER USER 'root'@'localhost' IDENTIFIED WITH caching_sha2_password BY 'yourpasswd';
```

```
sudo mysql -u root -p123456(密码) 
create database kob；#创建kob数据库
use kob; #在kob内创建
vim create_tabble.sql #建一个表，:set paste  i进入复制模式，复制-> 退出（此命令在mysql中运行）
source create_tabble.sql；  #运行代码，创建应该表
```
## 13. 安装Java8
```
sudo apt-get update
sudo apt-get install openjdk-8-jdk
```

## 14. 重要！！！（错误：acs is not in the sudoers file.  This incident will be reported）
如果在docker中无法使用sudo命令，即出现这种错误```acs is not in the sudoers file.  This incident will be reported.```
### **解决办法：**
### 1. 方法一
从通过```docker attach my_docker_server  # 进入创建的docker容器``` 命令进入docker，这种方式进入会有root权限
### 2. 方法二
如果想给dockers下的用户配置sudo权限
```
adduser acs # 创建用户
acs usermod -aG sudo acs # 给用户acs分配sudo权限
```
## 15.出现```ssh: connect to host 39.107.87.195 port 20000: Connection refused```的解决办法
### **解决办法：**
### 1. 方法一 ：docker关闭了
```
docker start kob_server #如果不小心关闭，可以用这个打开
```
### 2. 方法二：目标主机上的SSH服务未运行
```
sudo service ssh start
```
## 16. 打包后端
为了后续配置nginx方便
每个api前面加上api
然后打包后端、打包之前先clean一下
```<packaging>jar</packaging>   #用于打包 ```
```
    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <!--这里写上main方法所在类的路径-->
                <configuration>
                    <mainClass>com.kob.botrunningsystem.BotRunningSystemApplication</mainClass>
                </configuration>
                <executions>
                    <execution>
                        <goals>
                            <goal>repackage</goal>
                        </goals>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>
```
![Alt][pic1]

## 17. 给ip地址绑定一个域名
/etc/nginx/cert/acapp.key
/etc/nginx/cert/acapp.pem
将以上内容配置好
然后是nginx.conf
## 18. 打包前端
在Vue的脚手架中直接打包成dist文件夹然后上传服务器即可
## !!! 19.Linux常用命令
1.  scp XXX  springboot：    -----把文件传到springboot中
2. scp -r XXX  springboot：    -----把文件夹传到springboot中
3.  mkdir XXX              -----创建文件夹
4. vim  XXX                ------修改某个文件的内容
5. rm  XXX                ------删除文件
6. rm XXX -r              -----删除文件夹
7. cp ~/*.jar .                        ------把家目录的后缀为jar的文件复制到本文件夹
8. mv dist/* .           ------把dist目录的的文件剪切到本文件夹
8. java -jar XXX.jar           -------启动某个jar包
9.  cd ..                 ---------进入上一级文件夹
## 19. ssh登录
![Alt][pic2]
![Alt][pic3]
![Alt][pic4]
![Alt][pic5]

[pic1]:https://thumbnail0.baidupcs.com/thumbnail/7d4520bacs3c6061bdb5e9a502472d65?fid=828221211-250528-221405122271381&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-Y25XQDvzyzRA5Q0nFAaKgUY1miw%3d&expires=8h&chkbd=0&chkv=0&dp-logid=9010976772528718895&dp-callid=0&time=1701774000&size=c1999_u1999&quality=100&vuk=828221211&ft=image
[pic2]:https://thumbnail0.baidupcs.com/thumbnail/fcb132b02u9ac60e36a2fb84e8cfd62b?fid=828221211-250528-17173475608253&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-vRXYz0TwMcaSsmfw88Z5Fh%2fm%2btE%3d&expires=8h&chkbd=0&chkv=0&dp-logid=9011377305357719928&dp-callid=0&time=1701774000&size=c1999_u1999&quality=100&vuk=828221211&ft=image
[pic3]:https://thumbnail0.baidupcs.com/thumbnail/1ca80ecc8hc986fffe4d32e85126c70b?fid=828221211-250528-1022393429633795&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-v3mpOlTtq0hbkbYvaHHCXdmGs%2bA%3d&expires=8h&chkbd=0&chkv=0&dp-logid=9011377305357719928&dp-callid=0&time=1701774000&size=c1999_u1999&quality=100&vuk=828221211&ft=image
[pic4]:https://thumbnail0.baidupcs.com/thumbnail/4c45e6cefmd38c9468c0524bc8159363?fid=828221211-250528-1077212510321914&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-sTLRkQm5ReOHhQEE6t%2fVjnJGFhs%3d&expires=8h&chkbd=0&chkv=0&dp-logid=9011422329103220285&dp-callid=0&time=1701774000&size=c1999_u1999&quality=100&vuk=828221211&ft=image
[pic5]:https://thumbnail0.baidupcs.com/thumbnail/9a2aba74bh3ed19d2d6e76a3bade59bf?fid=828221211-250528-1068367015954493&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-gOXjvnG6fPH%2fEa6njaeTA3b0yc8%3d&expires=8h&chkbd=0&chkv=0&dp-logid=9011428964634436284&dp-callid=0&time=1701777600&size=c1999_u1999&quality=100&vuk=828221211&ft=image


